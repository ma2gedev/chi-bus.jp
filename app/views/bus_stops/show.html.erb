<% cache params[:id] do %>
  <div class="row page-top-search-box">
    <div class="col-sm-4">
      <%= render partial: 'bus_stop_search_form' %>
      <h1><%= @bus_stop.name %></h1>
      <p><%= link_to @bus_stop.address + '付近', "http://maps.google.co.jp/maps?q=#{@bus_stop.latitude},#{@bus_stop.longitude}" %></p>
      <ol>
        <% @bus_stop.bus_route_infos.each do |info| %>
          <li><%= link_to "#{info.operation_company} #{info.line_name}", bus_route_info_path(info) %></li>
        <% end %>
      </ol>
    </div>
    <div class="col-sm-8">
      <div id="map" class="map"></div>
      <script type="text/javascript">
handler = Gmaps.build('Google');
handler.buildMap({ provider: { draggable: false, scrollwheel: false }, internal: {id: 'map'}}, function(){
  markers = handler.addMarkers(<%=raw build_markers(@bus_stop).to_json %>);
  polylines = handler.addPolylines(<%=raw build_routes_hash(@bus_stop.bus_route_infos).to_json %>, { strokeColor: '#00f', strokeOpacity: 0.5 });
  handler.bounds.extendWith(polylines);
  handler.fitMapToBounds();
});
      </script>
    </div>
  </div>
  <%= link_to 'ホーム', root_path, class: 'btn btn-default' %>
  <%= link_to '戻る', 'javascript:history.back()', class: 'btn btn-default' %>
<% end %>
